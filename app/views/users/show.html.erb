<% provide :head_tags do %>
  <meta name='turbolinks-visit-control' content='reload'>
    <script>
        document.addEventListener("DOMContentLoaded", function(){
            initMap( <%=@user.id %>, <%= User.first.location.latitude%>, <%= User.first.location.longitude%>, "fullmatching")
        });
    </script>
<% end %>
<p>
<div class="row">
  <div class="col-sm-1">
  </div>
  <div class="col-sm-2">
    <%= render partial: "users/user_panel", locals: {user: @user} %>
  </div>
  <div class="col-sm-6">
    <div class="col-sm-6"></div>
    <div class="col-sm-6">
      <p>
        <h2><%= @user.name %> <%= @user.surname %></h2>
        <%= @user.nickname %>
      </p>
    <p>
<%= %>
      <div id="map"></div>
    </p>
    </div>
    <button id="id_button" class="btn btn-primary" onclick="getLocation()"> Confirm location </button>
<script>
    function getLocation(){
        console.log("button pressed")
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition( function(position) {
                pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                $.ajax({
                    url : "http://localhost:3000/users/" + <%=@user.id %>,
                    type : "put",
                    data : { user: { latitude: pos.lat, longitude: pos.lng } }
                });
            });
        }
    }
</script>
  </div>
</div>

<script>
    function initMap(id, lat, lng, icon_type) {

        let pos = position(id, icon_type);
        return pos

    }
    function position(id, icon_type){
        let pos;
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition( function(position) {
                pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                var MyPos = new google.maps.LatLng(pos.lat, pos.lng)

                var mapOptions = {
                    center: MyPos,
                    zoom: 16
                };

                var map = new google.maps.Map(document.getElementById('map'), mapOptions);

                var icons = {
                    friend: {
                        icon: "https://img.icons8.com/dusk/50/000000/user-location.png"
                    },
                    fullmatching: {
                        icon: "https://img.icons8.com/dusk/64/000000/visit.png"
                    },
                    halfmatching: {
                        icon: "https://img.icons8.com/wired/64/000000/visit.png"
                    },
                    current_user: {
                        icon: "https://img.icons8.com/dusk/50/000000/marker.png"
                    }
                };

                var marker = new google.maps.Marker({
                    position: MyPos,
                    animation: google.maps.Animation.DROP,
                    map: map,
                    icon: icons[icon_type].icon,
                    draggable: true
                });

            });
        }
        return pos;
    }
</script>
